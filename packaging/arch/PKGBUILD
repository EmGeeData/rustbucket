# Maintainer: EmGeeData <emgeedata@protonmail.com>

pkgname=rustbucket
pkgver=1.0.0
pkgrel=1
pkgdesc="Blazing-fast, memory-efficient CLI tool for converting images to themed color palettes"
arch=('x86_64' 'i686' 'aarch64')
url="https://github.com/emgeedata/rustbucket"
license=('MIT')
depends=()
makedepends=('rust' 'cargo')
source=("$pkgname-$pkgver.tar.gz::https://github.com/emgeedata/rustbucket/archive/v$pkgver.tar.gz")
sha256sums=('SKIP')

build() {
    cd "$pkgname-$pkgver"
    
    # Build the main binary
    cargo build --release --locked --target-dir=target
    
    # Generate shell completions
    cargo run --bin generate-completions --release
}

check() {
    cd "$pkgname-$pkgver"
    
    # Run the test suite
    cargo test --release
}

package() {
    cd "$pkgname-$pkgver"
    
    # Install main binary
    install -Dm755 target/release/rtbt "$pkgdir/usr/bin/rtbt"
    
    # Install shell completions
    install -Dm644 completions/bash/rtbt.bash "$pkgdir/usr/share/bash-completion/completions/rtbt"
    install -Dm644 completions/zsh/_rtbt "$pkgdir/usr/share/zsh/site-functions/_rtbt"
    install -Dm644 completions/fish/rtbt.fish "$pkgdir/usr/share/fish/vendor_completions.d/rtbt.fish"
    
    # Install license
    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
    
    # Install documentation
    install -Dm644 README.md "$pkgdir/usr/share/doc/$pkgname/README.md"
    
    # Install man page
    install -Dm644 docs/man/rtbt.1 "$pkgdir/usr/share/man/man1/rtbt.1"
}